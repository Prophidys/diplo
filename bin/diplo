#!/bin/bash

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && cd .. && pwd )"
if [ ! -f $DIR/conf/diplo.cfg ]
then
	echo "Diplo config file $DIR/conf/diplo.cfg is missing"
	exit 1
fi

source $DIR/conf/diplo.cfg

if [ ! -z $WORKSPACEDIR ]
then
	WORKSPACEDIR="$DIR/workspace"
fi

LIBDIR=$DIR/lib

command=$1
shift
case $command in
	create)
		source $LIBDIR/workspace.bash
		create $@
		;;
	import)
		source $LIBDIR/workspace.bash
		import $@
		;;
	list)
		source $LIBDIR/workspace.bash
		list $@
		;;
	go)
		source $LIBDIR/workspace.bash
		go $@
		;;
	update)
		source $LIBDIR/base.bash
		update $@
		;;
	list-plugins)
		source $LIBDIR/plugins.bash
		list-plugins
		;;
	install)
		source $LIBDIR/plugins.bash
		pinstall $@
		;;
	update-plugin)
		source $LIBDIR/plugins.bash
		pupdate $@
		;;
	help)
		source $LIBDIR/base.bash
		usage $@
		;;
	*)
		source $LIBDIR/plugins.bash
		validate $command $@
		;;
esac
